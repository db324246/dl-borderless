function t(){this.sin=t.sin,this.cos=t.cos,this.sqrtC=t.sqrtC,this.radian=t.radian,this.getRandom=t.getRandom,this.getRandomColor=t.getRandomColor}t.sin=function(i){return Math.sin(t.radian(i))},t.cos=function(i){return Math.cos(t.radian(i))},t.radian=function(t){return Math.PI*t/180},t.pointsToAngle=function(t,i,e,s){const h=Math.abs(s-i),a=Math.abs(e-t);let r=180*Math.atan(h/a)/Math.PI;return t>e?(r=180-r,i>s&&(r=180-r+180)):i>s&&(r=360-r),r},t.sqrtC=function(t,i){return Math.floor(Math.sqrt(Math.pow(t,2)+Math.pow(i,2)))},t.getRandom=function(t,i){return Math.floor(Math.random()*(i-t+1))+t},t.getRandomColor=function(){return`rgba(${t.getRandom(0,255)}, ${t.getRandom(0,255)}, ${t.getRandom(0,255)}, 1)`},t.deepClone=function(i){if(!i||"object"!=typeof i)return i;const e=i.constructor===Array?[]:{};return Object.keys(i).forEach((s=>{i[s]&&"object"==typeof i[s]?e[s]=t.deepClone(i[s]):e[s]=i[s]})),e},t.typeOf=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},t.genNonDuplicateID=function(){let t=Date.now().toString(36);return t+=Math.random().toString(36).substr(3,6),t};var i=t;const e=i;class s{constructor({x:t,y:i,data:h,width:a,height:r,padding:n,ctx:o,maskCtx:c}){this.id=e.genNonDuplicateID(),this.ctx=o,this.maskCtx=c,this.x=t,this.y=i,this.data=h,this.width=a,this.padding=n,this.computedHeight(r),this.color=e.getRandomColor(),this.visible=!0,this.hovering=!1,this.imageReady=!1,this.loadImage(),this.transform=0,Reflect.set(s.pathsMap,this.id,this),Reflect.set(s.visiblesMap,this.id,this),s.total=Object.values(s.pathsMap).length}draw(){this.hovering?(this.transform=this.transform>=10?10:this.transform+1,this.drawHandler(this.maskCtx,this.transform)):(this.transform=this.transform<=0?0:this.transform-1,this.transform&&this.drawHandler(this.maskCtx,this.transform)),this.drawHandler(this.ctx)}update(){this.checkPosition(),this.visible&&this.draw()}clear(){this.ctx.clearRect(this.x-this.transform,this.y-this.transform,this.width+2*this.transform,this.height+2*this.transform),this.maskCtx.clearRect(this.x-this.transform,this.y-this.transform,this.width+2*this.transform,this.height+2*this.transform)}checkPosition(){const t=this.visible;this.visible=this.x>=0-this.width&&this.x<=this.ctx.canvas.width&&this.y>=0-this.height&&this.y<=this.ctx.canvas.height,t&&!this.visible?Reflect.deleteProperty(s.visiblesMap,this.id):!t&&this.visible&&Reflect.set(s.visiblesMap,this.id,this)}loadImage(){this.data.url&&(this.img=new Image,this.img.src=this.data.url,this.img.onload=()=>{this.imageReady=!0,this.computedImageRatio(),this.ctx.drawImage(this.img,this.renderX,this.renderY,this.renderWidth,this.renderHeight,this.x+this.padding-this.transform,this.y+this.padding-this.transform,this.rWidth+2*this.transform,this.rHeight+2*this.transform)})}drawHandler(t,i=0){this.path=new Path2D,this.hoverPath=new Path2D,this.path.rect(this.x,this.y,this.width,this.height),this.hoverPath.rect(this.x+1,this.y+1,this.width-2,this.height-2),t.fillStyle="#fff",t.fillRect(this.x-i,this.y-i,this.width+2*i,this.height+2*i),t.fill(this.path),t.fill(this.hoverPath),this.imageReady&&t.drawImage(this.img,this.renderX,this.renderY,this.renderWidth,this.renderHeight,this.x+this.padding-i,this.y+this.padding-i,this.rWidth+2*i,this.rHeight+2*i)}computedHeight(t){const{width:i,height:s}=this.data;if(i&&s){const t=i/s;this.height=this.width/t}else this.height="array"===e.typeOf(t)?e.getRandom(...t):t}computedImageRatio(){this.imgWidth=this.img.width,this.imgHeight=this.img.height;const t=this.imgWidth/this.imgHeight;this.rWidth=this.width-2*this.padding,this.rHeight=this.height-2*this.padding;t>=this.rWidth/this.rHeight?(this.renderHeight=this.imgHeight,this.renderWidth=Math.round(this.rWidth/this.rHeight*this.imgHeight),this.renderY=0,this.renderX=Math.round((this.imgWidth-this.renderWidth)/2)):(this.renderWidth=this.imgWidth,this.renderHeight=Math.round(this.rHeight/this.rWidth*this.imgWidth),this.renderX=0,this.renderY=Math.round((this.imgHeight-this.renderHeight)/2))}}s.pathsMap={},s.visiblesMap={},s.destroy=t=>{t.forEach((t=>{Reflect.deleteProperty(s.pathsMap,t),Reflect.deleteProperty(s.visiblesMap,t)})),s.total=Object.values(s.pathsMap).length};const h=s,a=i;var r=class{constructor(t={}){this.validateConfig(t);const{el:i,data:e,width:s,height:h,maxsize:r,boxWidth:n,boxHeight:o,className:c,boxPadding:d,draggable:g,mousehover:l,animation:m,animationSpeed:u}=t;s&&h?(this.containerWidth=s,this.containerHeight=h):(this.containerWidth=window.innerWidth,this.containerHeight=window.innerHeight),this.data=a.deepClone(e||[]),this.parentDom=document.querySelector(i)||document.body,this.className=c,this.draggable=g,this.mousehover=l,this.animation=m,this.animationSpeed=u||{},this.maxsize=r||500,this.boxWidth=n||150,this.boxHeight=o||[150,300],this.boxPadding=void 0!==d?d:5,this.boxRect=[],this.firstScreen=!0,this.initContainer()}validateConfig(t){const i=a.typeOf;if("object"!==i(t))throw new Error("config must be a object");if(Reflect.has(t,"el")&&"string"!==i(t.el))throw new Error("el must be a string");if(Reflect.has(t,"animationSpeed")&&"object"!==i(t.animationSpeed))throw new Error("animationSpeed must be a object");if(Reflect.has(t,"boxHeight")&&!["number","array"].includes(i(t.boxHeight)))throw new Error("boxHeight must be a number or a array for random range");if(Reflect.has(t,"data")){const e=t.data;if("array"!==i(e))throw new Error("data must be a array");for(let t=0;t<e.length;t++){const s=e[t];if("object"!==i(s))throw new Error("data item must be a object");if("string"!==i(s.url))throw new Error("item's url is required and must be a string");if(Reflect.has(s,"width")&&"number"!==i(s.width))throw new Error("item's width must be a number");if(Reflect.has(s,"height")&&"number"!==i(s.height))throw new Error("item's height must be a number")}}}initContainer(){this.container=document.createElement("div"),this.container.className=this.className,this.container.style.position="relative",this.container.style.width=this.containerWidth+"px",this.container.style.height=this.containerHeight+"px",this.createCanvas(),this.parentDom.appendChild(this.container)}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.width=this.containerWidth,this.canvas.height=this.containerHeight,this.ctx=this.canvas.getContext("2d"),this.registerEvents(),this.maskCanvas=document.createElement("canvas"),this.maskCanvas.style.position="absolute",this.maskCanvas.style.left=0,this.maskCanvas.style.top=0,this.maskCanvas.style.pointerEvents="none",this.maskCanvas.width=this.containerWidth,this.maskCanvas.height=this.containerHeight,this.maskCtx=this.maskCanvas.getContext("2d"),this.registerHover(),this.container.appendChild(this.canvas),this.container.appendChild(this.maskCanvas)}draw(){this.drawFirstScreen(),this.registerAnimation()}drawFirstScreen(){const t=this.containerWidth/2,i=this.containerHeight/2,e=new h({x:Math.ceil(t-this.boxWidth/2),ctx:this.ctx,maskCtx:this.maskCtx,width:this.boxWidth,height:this.boxHeight,padding:this.boxPadding,data:this.getDataItem()});e.y=Math.ceil(i-e.height/2),e.draw();const s=[];s.push(e),this.boxRect.push(s);const a=()=>{const t=this.drawHole();h.total>this.maxsize||t&&a()};a(),this.firstScreen=!1}checkFirstRowHole(t){const i=Object.values(h.visiblesMap);for(let e=0;e<=this.containerWidth;e+=this.boxWidth)if(i.every((i=>!t.isPointInPath(i.path,e,0)))){if(h.total>this.maxsize){const t=this.boxRect.pop();h.destroy(t.map((t=>t.id)))}const i=this.boxRect[0].map((i=>{const e=new h({ctx:t,x:i.x,maskCtx:this.maskCtx,width:this.boxWidth,height:this.boxHeight,padding:this.boxPadding,data:this.getDataItem()});return e.y=i.y-e.height,e.update(),e}));return this.boxRect.unshift(i),!0}return!1}checkFirstColHole(t){const i=Object.values(h.visiblesMap),e=this.boxRect.map((t=>t[0]));for(let s=0;s<=this.containerHeight;s+=this.containerHeight)if(i.every((i=>!t.isPointInPath(i.path,0,s)))){h.total>this.maxsize&&h.destroy(this.boxRect.reduce(((t,i)=>{const e=i.pop();return t.push(e.id),t}),[]));let i=0;const s=[];for(;i<e.length;){const a=e[i];let r=0;if(i>0){const t=s[i-1];r=t.y+t.height}else r=e[0].y;const n=new h({ctx:t,y:r,x:a.x-this.boxWidth,maskCtx:this.maskCtx,width:this.boxWidth,height:this.boxHeight,padding:this.boxPadding,data:this.getDataItem()});s.push(n),this.boxRect[i].unshift(n),n.update(),i++}return!0}return!1}checkLastRowHole(t){const i=Object.values(h.visiblesMap);for(let e=0;e<=this.containerWidth;e+=this.boxWidth)if(i.every((i=>!t.isPointInPath(i.path,e,this.containerHeight)))){if(h.total>this.maxsize){const t=this.boxRect.shift();h.destroy(t.map((t=>t.id)))}const i=this.boxRect[this.boxRect.length-1].map((i=>{const e=new h({ctx:t,x:i.x,y:i.y+i.height,maskCtx:this.maskCtx,width:this.boxWidth,height:this.boxHeight,padding:this.boxPadding,data:this.getDataItem()});return e.update(),e}));return this.boxRect.push(i),!0}return!1}checkLastColHole(t){const i=Object.values(h.visiblesMap),e=this.boxRect.map((t=>t[t.length-1]));for(let s=0;s<=this.containerHeight;s+=this.containerHeight)if(i.every((i=>!t.isPointInPath(i.path,this.containerWidth,s)))){h.total>this.maxsize&&h.destroy(this.boxRect.reduce(((t,i)=>{const e=i.shift();return t.push(e.id),t}),[]));let i=0;const s=[];for(;i<e.length;){const a=e[i];let r=0;if(i>0){const t=s[i-1];r=t.y+t.height}else r=e[0].y;const n=new h({ctx:t,y:r,x:a.x+this.boxWidth,maskCtx:this.maskCtx,width:this.boxWidth,height:this.boxHeight,padding:this.boxPadding,data:this.getDataItem()});s.push(n),this.boxRect[i].push(n),n.update(),i++}return!0}return!1}drawHole(t){let i=!1;switch(t){case 1:i=this.checkLastRowHole(this.ctx),i=this.checkLastColHole(this.ctx)||i;break;case 2:i=this.checkLastRowHole(this.ctx);break;case 3:i=this.checkFirstColHole(this.ctx),i=this.checkLastRowHole(this.ctx)||i;break;case 4:i=this.checkLastColHole(this.ctx);break;case 5:break;case 6:i=this.checkFirstColHole(this.ctx);break;case 7:i=this.checkFirstRowHole(this.ctx),i=this.checkLastColHole(this.ctx)||i;break;case 8:i=this.checkFirstRowHole(this.ctx);break;case 9:i=this.checkFirstRowHole(this.ctx),i=this.checkFirstColHole(this.ctx)||i;break;default:i=this.checkFirstRowHole(this.ctx),i=this.checkLastRowHole(this.ctx)||i,i=this.checkFirstColHole(this.ctx)||i,i=this.checkLastColHole(this.ctx)||i}return i}getDataItem(){const t=this.data.find((t=>!t.used));if(t)return t.used=!0,t;if(!this.data.length)return{};const i=a.getRandom(0,this.data.length-1);return this.data[i]||{}}registerEvents(){const t=this.draggingHandler.bind(this);this.dragData={dragging:!1,mouseX:0,mouseY:0,requestId:""},this.canvas.addEventListener("mousedown",(i=>{this.draggable&&(this.dragData.mouseX=i.offsetX,this.dragData.mouseY=i.offsetY,this.dragData.dragging=!0,this.canvas.addEventListener("mousemove",t))})),document.addEventListener("mouseup",(()=>{this.dragData.dragging=!1,this.registerAnimation(),this.canvas.removeEventListener("mousemove",t)})),this.canvas.addEventListener("click",(t=>{if(this.onclick){if("function"!==a.typeOf(this.onclick))throw new Error("onclick must be a function");Object.values(h.visiblesMap).forEach((i=>{this.ctx.isPointInPath(i.path,t.offsetX,t.offsetY)&&this.onclick(i)}))}}))}draggingHandler(t){const i=t.offsetX-this.dragData.mouseX,e=t.offsetY-this.dragData.mouseY;this.dragData.mouseX=t.offsetX,this.dragData.mouseY=t.offsetY,this.ctx.clearRect(0,0,this.containerWidth,this.containerHeight),Object.values(h.pathsMap).forEach((t=>{t.x+=i,t.y+=e,t.update()}));const s=this.computedDirection(i,e);this.drawHole(s)}registerHover(){this.hoverData={prev:null,cur:null,mouseX:0,mouseY:0,hovering:!1,hoverRequestId:""},this.canvas.addEventListener("mouseenter",(()=>{this.mousehover&&(this.hoverData.hovering=!0,this.hoverHandler())})),this.canvas.addEventListener("mousemove",(t=>{this.mousehover&&(this.hoverData.mouseX=t.offsetX,this.hoverData.mouseY=t.offsetY,this.checkHovering())})),this.canvas.addEventListener("mouseleave",(()=>{this.mousehover&&(this.hoverData.hovering=!1,this.hoverData.prev=this.hoverData.cur,this.hoverData.cur=null,this.hoverData.prev.hovering=!1)}))}checkHovering(){this.hoverData.hovering&&Object.values(h.visiblesMap).forEach((t=>{t.hovering=this.ctx.isPointInPath(t.hoverPath,this.hoverData.mouseX,this.hoverData.mouseY),!t.hovering||this.hoverData.cur&&this.hoverData.cur.id===t.id||(this.hoverData.prev=this.hoverData.cur,this.hoverData.cur=t)}))}hoverHandler(){const{hovering:t,prev:i,cur:e,hoverRequestId:s}=this.hoverData;this.maskCtx.clearRect(0,0,this.containerWidth,this.containerHeight),t||!i||i.transform?(i&&i.update(),e&&e.update(),this.hoverData.hoverRequestId=window.requestAnimationFrame(this.hoverHandler.bind(this))):s&&window.cancelAnimationFrame(s)}registerAnimation(){if(!this.animation||this.dragData.dragging)return void(this.dragData.requestId&&window.cancelAnimationFrame(this.dragData.requestId));this.ctx.clearRect(0,0,this.containerWidth,this.containerHeight),this.maskCtx.clearRect(0,0,this.containerWidth,this.containerHeight),Object.values(h.pathsMap).forEach((t=>{t.x+=this.animationSpeed.x||-1,t.y+=this.animationSpeed.y||1,t.update()}));const t=this.computedDirection(this.animationSpeed.x||-1,this.animationSpeed.y||1);this.drawHole(t),this.checkHovering(),this.dragData.requestId=window.requestAnimationFrame(this.registerAnimation.bind(this))}computedDirection(t,i){return t>0?i<0?3:0===i?6:9:0===t?i<0?2:0===i?5:8:i<0?1:0===i?4:7}};export{r as default};
